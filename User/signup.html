<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign Up</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <section class="auth-page">
      <div class="auth-container">
        <div class="auth-header">
          <img
            src="../Images/Group 1.png"
            alt="Smart Crop Advisor"
            class="auth-logo"
          />
        </div>
        <form id="signup-form" class="auth-form">
          <div class="form-group">
            <label for="signup-name" class="form-label">Full Name</label>
            <input
              type="text"
              id="signup-name"
              class="form-input"
              placeholder="Enter your full name"
            />
            <span id="name-error" class="form-error hidden"></span>
          </div>
          <div class="form-group">
            <label for="signup-email" class="form-label">Email Address</label>
            <input
              type="text"
              id="signup-email"
              class="form-input"
              placeholder="Enter your email"
            />
            <span id="email-error" class="form-error hidden"></span>
          </div>
          <div class="form-group">
            <label for="signup-password" class="form-label">Password</label>
            <input
              type="password"
              id="signup-password"
              class="form-input"
              placeholder="Create a password"
            />
            <span id="password-error" class="form-error hidden"></span>
          </div>
          <button
            type="submit"
            id="submit-btn"
            class="btn btn-primary btn-full"
          >
            Sign Up
          </button>
        </form>
        <div class="auth-footer flex-footer">
          <a href="login.html" class="btn-sm btn-outline"
            >Have account? Login</a
          >
          <a href="../Admin/login.html" class="btn-sm btn-outline">I'm Admin</a>
        </div>
      </div>
    </section>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../supabase-config.js"></script>

    <script>
      // Function to display error messages on the form
      function showError(inputId, errorId, message) {
        let inputElement = document.getElementById(inputId);
        inputElement.classList.add("error");

        let errorElement = document.getElementById(errorId);
        errorElement.textContent = message;
        errorElement.classList.remove("hidden");
      }

      // Function to clear all error messages
      function clearErrors() {
        document.getElementById("signup-name").classList.remove("error");
        document.getElementById("signup-email").classList.remove("error");
        document.getElementById("signup-password").classList.remove("error");

        document.getElementById("name-error").classList.add("hidden");
        document.getElementById("email-error").classList.add("hidden");
        document.getElementById("password-error").classList.add("hidden");
      }

      // Function to handle sign up process
      function handleSignup(event) {
        // Prevent default submission of form
        event.preventDefault();

        clearErrors();
        // Get values from the form inputs
        let name = document.getElementById("signup-name").value.trim();
        let email = document.getElementById("signup-email").value.trim();
        let password = document.getElementById("signup-password").value;
        let submitBtn = document.getElementById("submit-btn");

        if (name === "") {
          showError("signup-name", "name-error", "Name is required");
          return;
        }

        if (email === "") {
          showError("signup-email", "email-error", "Email is required");
          return;
        }

        if (password.length < 6) {
          showError(
            "signup-password",
            "password-error",
            "Password must be at least 6 characters"
          );
          return;
        }

        // If success sign up show creating account...
        submitBtn.textContent = "Creating account...";
        submitBtn.disabled = true;

        // Call the signUp function from supabase-api.js
        signUp(email, password, name)
          .then(function () {
            // Navigate user to the home page
            window.location.href = "index.html";
          })
          .catch(function (error) {
            // Reset the button
            submitBtn.textContent = "Create Account";
            submitBtn.disabled = false;

            // Show error message
            showError(
              "signup-email",
              "email-error",
              getFriendlyErrorMessage(error)
            );
          });
      }

      // Function to initialize the page
      function initSignupPage() {
        document
          .getElementById("signup-form")
          .addEventListener("submit", handleSignup);

        // Check if user is already logged in
        _supabase.auth.getSession().then(function (response) {
          if (response.data.session) {
            window.location.href = "index.html";
          }
        });
      }
      document.addEventListener("DOMContentLoaded", initSignupPage);
    </script>
  </body>
</html>
